# 目次
- [はじめに](#はじめに)
- [環境設定](#環境設定)
   - [GitHub](#githubについて)
   - [Hugging Face](#hugging-face-について)
   - [Streamlit Cloud](#streamlit-cloud-について)
- [利用方法](#利用方法)
   - [アプリの利用](#アプリの利用について)
   - [APIキーと利用制限](#APIキーと利用制限について)

# はじめに
本アプリは、南海放送のTV番組のナレーション原稿から、新聞に掲載するTV番組の広告文を生成するものである  

# 環境設定
本アプリは、以下の3つの外部サービスを利用して動作する
- **GitHub** : アプリのプログラムを保存・管理する場所
- **Hugging Face** : 広告文を生成するAIを利用するためのサービス
- **Streamlit Cloud** : Webブラウザ上でアプリを動作させるための実行環境

これらはそれぞれ役割が異なっており、順番に設定を行うことでアプリを利用できるようになる  
全てのサービスにおいて無料枠があり、無料で利用することができる

## GitHubについて
GitHubとは、インターネット上にある保管場所のようなもので、アプリのプログラムを安全に保存・管理するためのサービスである

### アカウント作成
1. [GitHub](https://github.com)のサイトへアクセス
2. 右上の `Sign up` をクリック
3. メールアドレス、パスワード、ユーザーネームなどを入力し、`Create account` ボタンをクリックしてアカウントを作成

### リポジトリをコピー
リポジトリとは、アプリを構成するプログラムや設定ファイル一式をまとめて保管している場所のことで、この中にアプリの動作に必要なファイルが全て入っている  
他のリポジトリを自分のアカウントにコピーする動作をFork（フォーク）という  
今回は、我々のアカウントにあるリポジトリを自分のアカウントにコピーし、それを使ってアプリを実行する
1. [GitHub](https://github.com/fortune-lab3/PBL/)にアクセス
2. 右上の `Fork` ボタンをクリック
3. 右下の緑色 `Create Fork` ボタンをクリックして自分のリポジトリにコピー

## Hugging Face について
Hugging Faceは、AIモデルを提供しているサービスである  
本アプリでは、広告文を生成する機能を利用するために使っている

### アカウント作成
1. [Hugging Face](https://huggingface.co)のサイトへアクセス
2. 右上の `Sign Up` ボタンをクリック
3. メールアドレス、パスワード、ユーザーネームを入力してアカウントを作成

### Hugging Face APIキーを取得
APIとは、外部のサービスに機能を依頼するための窓口のことで、APIキーはその機能を利用するための認証用の鍵のようなものである  
本アプリではAPIキーを通じてAIモデルを利用するため、APIキーを取得する
1. [Hugging Face](https://huggingface.co)にログイン
2. 右上の丸いアイコンをクリックし、`Settings` ボタンをクリック
3. 左側にある `Access Tokens` をクリック
4. 右上にある `+ Create new token` をクリック
5. Token type を `Read` にして Token name に任意の名前を入力
6. `Create token` ボタンをクリックしてAPIキーを作成
7. 表示される `hf_` からはじまるAPIキーをコピー（このときにしか表示されないので絶対にコピーしておく）

**※APIキーは絶対に外部に公開しない**

## Streamlit Cloud について
Streamlit Cloudは、GitHub上に保存したプログラムを実行し、Webブラウザ上でアプリとして利用できるようにするサービスである  
ここでは、自分のGitHubアカウントにコピーしたリポジトリを使い、アプリを利用できる状態にする

### アカウント作成
1. [Streamlit Cloud](https://share.streamlit.io/)にアクセス
2. `Continue to sign-in` ボタンをクリック
3. `GitHubで続行` を選択し、連携を許可

### アプリを作成
プログラムを実際に利用できる状態にすることをDeploy（デプロイ）という  
ここでは、GitHub上のプログラムを読み込み、ブラウザからアクセスできる状態にするためにデプロイを行う
1. [share.streamlit](https://share.streamlit.io/)にアクセス
2. 右上の `Create app` をクリック
3. `Deploy a public app from GitHub` を選択
4. Repositoryに `アカウント名/PBL`、Branchに `main`、Main file pathに `app.py` を選択（枠をクリックすると候補がでてくる）
5. App URLに任意の名前を入力（これがアプリのURLになる）
6. `Deploy` をクリックしてアプリを作成

※アプリは、URLを共有した人のみが利用できる

### APIキー設定
Streamlit Cloud上で本アプリを動作させるためには、APIキーを安全な場所（Secrets）に設定する必要がある  
Secretsに設定した情報は外部から直接閲覧することはできず、実行時にのみアプリへ安全に提供される
1. [share.streamlit](https://share.streamlit.io/)にアクセス
2. 作成したアプリ（pbl・main・app.py）の右端にある︙をクリックし、`Settings` をクリック
3. 左側にある `Secrets` をクリック
4. 枠の中に以下を入力（`""` の間に、先ほど取得してコピーしたAPIキーを貼り付け）
   ```text
   HUGGINGFACEHUB_API_TOKEN = "取得したAPIキー"
5. 右下の `Save changes` をクリックして保存
6. これで、作成したアプリ（pbl・main・app.py）をクリックすると使える

※一定期間アクセスがなければアプリがスリープ状態になるが、表示される `Yes, get this app back up!` ボタンをクリックして少し待てば起動する

# 利用方法
## アプリの利用について
左側のサイドバーで詳細設定を行い、原稿を入力して `広告文を生成` ボタンを押すと、数秒で広告文と文字数が表示される  
テキストボックスに入力した際、右下に小さく `Press Enter to apply` や `Press Ctrl+Enter to apply` と表示されるので、指示に従って入力内容を確定する  
出力された広告文は手動で編集することが可能である  
編集後に `Ctrl+Enter` を押すと、文字数表示も更新される  
ダウンロードボタンを押すと、選択したファイル形式および指定したファイル名で、広告文を保存することができる  

## APIキーと利用制限について
[Huggingface](https://huggingface.co/settings/inference-providers/overview)の `Inference Providers` のページにて、APIキーの利用状況を確認することができる  
無料利用枠には使用回数やトークン数の制限があり、基本的には毎月1日の9時にリセットされる  
ただし利用状況やシステムの都合により、1日後や1週間後に再度利用可能となる場合もある  
利用上限に達した場合の対応として、別のメールアドレスでHuggingfaceのアカウントを新規作成し、APIキーを取得するという方法がある

**※APIキーは絶対に外部に公開しない**
